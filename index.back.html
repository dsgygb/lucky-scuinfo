<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=yes;">
    <link rel="stylesheet" href="/css/weui.min.css">
    <link rel="stylesheet/less" href="/css/profile.less">
    <title>test</title>
</head>
<body>
<header id="header">

    <div class="weui_cells weui_cells_access">

        <a class="weui_cell header-my" href="javascript:;">
            <div class="weui_cell_hd header-avatar" id="my-avatar">
                <img src="http://tp2.sinaimg.cn/3656973697/180/40036683459/0" alt="icon" style="width:20px;margin-right:5px;display:block">
            </div>
            <div class="weui_cell_bd weui_cell_primary">
                <p id="my-nickname">-</p>
            </div>
            <div class="weui_cell_ft">
                进入我的主页(<span id="my-group-counts">-</span>个组合)
            </div>
        </a>
    </div>




            <section>

                <div class="activity-intro">
                    <p>介绍</p>
                    <a href="javascript:;" class="weui_btn weui_btn_plain_default activity-btn">点我查看都有哪些好吃的?</a>

                </div>

                <div class="activity-section">
                <div class="activity-section-icon"><i class="weui_icon_waiting_circle header-cell-hd"></i></div>
                <div class="activity-section-key">距离开奖还有:</div>
                <div class="activity-section-value" id="activity-to-time">----</div>
                </div>

                <div class="activity-section">
                    <div class="activity-section-icon"><i class="weui_icon_success_circle header-cell-hd"></i></div>
                    <div class="activity-section-key">当前参与人数:</div>
                    <div class="activity-section-value" id="group-counts">----</div>
                </div>
                <div class="activity-section">
                    <div class="activity-section-icon"><i class="weui_icon_success_circle header-cell-hd"></i></div>
                    <div class="activity-section-key">抽取总组合数:</div>
                    <div class="activity-section-value">100个组合</div>
                </div>

            </section>



</header>
<div id="container">


    <article class="group-item-header">
        <div class="group-avatar">
        <img src="http://tp2.sinaimg.cn/5668968461/180/5736696167/1">
        </div>
        <div class="group-info">
            <div class="group-nickname">小名plus</div>
            <div class="group-status">共8个组合</div>
        </div>
        <div class="group-btn"><a href="javascript:;" class="weui_btn weui_btn_plain_default join-btn">加入Ta的组合</a></div>
    </article>


    <article class="group-item">
        <div class="group-avatar">
            <img class="avatar-self" src="http://tp2.sinaimg.cn/2697176961/180/5742402136/0">
            <img class="avatar-friend" src="http://tp2.sinaimg.cn/5668968461/180/5736696167/1">
        </div>
        <div class="group-info">
            <div class="group-nickname">小米plus</div>
            <div class="group-status">未中奖</div>
        </div>
        <div class="group-lucky-id"><span class="group-lucky-key">抽奖码:</span>100001</div>
    </article>






</div>

<script>
    var data = sessionStorage.getItem('access_token');
    console.log(data);
    if(!data){
        location.href = '/auth?code=debug&stat='+encodeURIComponent(JSON.stringify({r:window.location.href}));
    }
</script>
<script src="/js/less.min.js"></script>

<script src="/js/zepto.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
<script>
    (function($){
        var expireTime = function(expires){
            if(expires > 0){
                var second = expires;
            }else{
                var second = "0 分";
                return second;
            }
            var day = hour = min = "";
            if(second>86400){
                day = Math.floor(second/86400)+"天 ";
                second = second%86400;
            }
            if(second>3600){
                hour = Math.floor(second/3600)+"时 ";
                second = second%3600;
            }
            if(second>60){
                min = Math.floor(second/60)+"分 ";
                second = second%60;
            }
            second = second+"秒";
            return day+hour+min+second;
        };
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURIComponent(r[2]); return null;
        }


        var userJSON = sessionStorage.getItem('user');

        try{
            var user = JSON.parse(userJSON);
        }catch(e){
            var user={};
        }

        console.log(user);
        $("#my-group-counts").text(user.group_counts);
        $("#my-avatar img").attr("src",user.avatar);
        $("#my-nickname").text(user.nickname);

        console.log(moment().to(1547725600000,true));
//todo 前端加油
        var profileUserId = getQueryString('u');
        
        $.getJSON("/api/stat/1",function(data){
            console.log(data);

            $("#group-counts").text(data.groups*2);
            var expire = data.lucky_time-parseInt(new Date().getTime()/1000);
            var timeEle = document.getElementById("activity-to-time");
            var timer = window.setInterval(function(){
                timeEle.innerHTML = expireTime(expire--);
                if(expire<0){
                    clearInterval(timer);
                }
            },1000);
            
        });

        $.getJSON("/api/profile/"+profileUserId,function(data){

        });


    })(Zepto);





</script>
</body>
</html>